<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1 Spatial Data with ggplot2 | spatial_ggplot2.utf8</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.20.6 and GitBook 2.6.7" />

  <meta property="og:title" content="1 Spatial Data with ggplot2 | spatial_ggplot2.utf8" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 Spatial Data with ggplot2 | spatial_ggplot2.utf8" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">GEOG473-673 Open-sourced Environmental Computing</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path=""><a href="#spatial-data-with-ggplot2"><i class="fa fa-check"></i><b>1</b> Spatial Data with ggplot2</a><ul>
<li class="chapter" data-level="1.1" data-path=""><a href="#simple-features"><i class="fa fa-check"></i><b>1.1</b> Simple Features</a></li>
<li class="chapter" data-level="1.2" data-path=""><a href="#sea-surface-temperature-ggplot"><i class="fa fa-check"></i><b>1.2</b> Sea Surface Temperature ggplot</a></li>
<li class="chapter" data-level="1.3" data-path=""><a href="#r-color-brewer-palettes"><i class="fa fa-check"></i><b>1.3</b> R Color Brewer Palettes</a><ul>
<li class="chapter" data-level="1.3.1" data-path=""><a href="#multi-plot-ggplot"><i class="fa fa-check"></i><b>1.3.1</b> Multi Plot ggplot</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path=""><a href="#extra-credit---2-points"><i class="fa fa-check"></i><b>1.4</b> Extra Credit - 2 Points</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">James Simkins</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:title:end-->
<!--bookdown:title:start-->
<div id="spatial-data-with-ggplot2" class="section level1">
<h1><span class="header-section-number">1</span> Spatial Data with ggplot2</h1>
<p><img src="../documents/images/ggplot2.jpeg" width="80%" style="display: block; margin: auto;" /></p>
<p>In Geospatial Sciences we’re constantly working with spatial datasets that come in many different projections. We’ve previously shown how R can be used to read in spatial data, reproject spatial data, and resample spatial datasets. Once a spatial dataset can be stored in R as a data frame, we can use <code>ggplot</code> to plot it.</p>
<table>
<colgroup>
<col width="28%" />
<col width="71%" />
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>geom_sf()</code></td>
<td>Adds geometry stored in a <code>sf</code> object to a ggplot</td>
</tr>
<tr class="even">
<td><code>coord_sf()</code></td>
<td>Provides coordinate specifications for a ggplot</td>
</tr>
<tr class="odd">
<td><code>geom_raster()</code></td>
<td>Plots a data frame as a raster on a ggplot</td>
</tr>
<tr class="even">
<td><code>st_crs()</code></td>
<td>Obtains projection information from an EPSG code</td>
</tr>
<tr class="odd">
<td><code>geom_sf_label()</code></td>
<td>adds label to an sf geometry</td>
</tr>
<tr class="even">
<td><code>scale_fill_gradientn()</code></td>
<td>adds a density plot to a ggplot</td>
</tr>
<tr class="odd">
<td><code>borders()</code></td>
<td>Adds country borders to a ggplot</td>
</tr>
<tr class="even">
<td><code>coord_quickmap()</code></td>
<td>Approximates projected lines for faster image creation</td>
</tr>
<tr class="odd">
<td><code>colorRampPalette()</code></td>
<td>Create custom color ramp palette</td>
</tr>
<tr class="even">
<td><code>brewer.pal()</code></td>
<td>Grabs premade color palette from RColorBrewer</td>
</tr>
<tr class="odd">
<td><code>grid.arrange()</code></td>
<td>Function that allows you to organize multiple ggplot objects into the same window</td>
</tr>
</tbody>
</table>
<div id="simple-features" class="section level2">
<h2><span class="header-section-number">1.1</span> Simple Features</h2>
<p>One package useful for spatial data in R is the <code>sf</code> package (short for simple features). It contains functions that perform equations that place uneven projections on a 2 dimensional computer screen. It can handle many projections and is built to work seamlessly with <code>ggplot</code>. For sample data, we’re also going to load <code>ozmaps</code> which contains maps of Australia.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(ozmaps)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(sf)</span></code></pre></div>
<pre><code>## Linking to GEOS 3.8.1, GDAL 3.1.4, PROJ 6.3.1</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>oz_states &lt;-<span class="st"> </span>ozmaps<span class="op">::</span>ozmap_states</span>
<span id="cb3-2"><a href="#cb3-2"></a>oz_states</span></code></pre></div>
<pre><code>## Simple feature collection with 9 features and 1 field
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: 105.5507 ymin: -43.63203 xmax: 167.9969 ymax: -9.229287
## geographic CRS: GDA94
## # A tibble: 9 x 2
##   NAME                                                                  geometry
##   &lt;chr&gt;                                                       &lt;MULTIPOLYGON [°]&gt;
## 1 New South Wales      (((150.7016 -35.12286, 150.6611 -35.11782, 150.6373 -35.…
## 2 Victoria             (((146.6196 -38.70196, 146.6721 -38.70259, 146.6744 -38.…
## 3 Queensland           (((148.8473 -20.3457, 148.8722 -20.37575, 148.8515 -20.3…
## 4 South Australia      (((137.3481 -34.48242, 137.3749 -34.46885, 137.3805 -34.…
## 5 Western Australia    (((126.3868 -14.01168, 126.3625 -13.98264, 126.3765 -13.…
## 6 Tasmania             (((147.8397 -40.29844, 147.8902 -40.30258, 147.8812 -40.…
## 7 Northern Territory   (((136.3669 -13.84237, 136.3339 -13.83922, 136.3532 -13.…
## 8 Australian Capital … (((149.2317 -35.222, 149.2346 -35.24047, 149.2716 -35.27…
## 9 Other Territories    (((167.9333 -29.05421, 167.9188 -29.0344, 167.9313 -29.0…</code></pre>
<p><code>oz_states</code> is a simple feature which stores data like data frames but has a projection (proj4string), spatial extents, and polygon geometry. In other words, we have shapes on a map that are georeferenced and stored within a data frame that <code>ggplot</code> is great at working with. There are two columns - <code>NAME</code> and <code>geometry</code>. The <code>NAME</code> column is the name of the Australian State. The <code>geometry</code> specifies where the lines of the polygons are drawn (the state boundaries). So, let’s plot these polygons!</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> oz_states) <span class="op">+</span><span class="st"> </span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="st">  </span><span class="kw">geom_sf</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="st">  </span><span class="kw">coord_sf</span>()</span></code></pre></div>
<p><img src="spatial_ggplot2_files/figure-html/unnamed-chunk-3-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># if we declare mapping aesthetics, we can tell ggplot to fill the spatial features (australian states) based on the NAME column / variable - ggplot automatically chooses coloring for us if we don&#39;t specify</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> oz_states, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">fill =</span> NAME)) <span class="op">+</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="st">  </span><span class="kw">coord_sf</span>()</span></code></pre></div>
<p><img src="spatial_ggplot2_files/figure-html/unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The function <code>coord_sf</code> allows to deal with the coordinate system, which includes both projection and extent of the map. By default, the map will use the coordinate system of the first layer that defines one (i.e. scanned in the order provided), or if none, fall back on WGS84 (latitude/longitude, the reference system used in GPS). Remember, our <code>oz_states</code> is a simple feature data frame that contains projection information. Thus, <code>coord_sf</code> is assuming we want the projection of <code>oz_states</code> - <code>+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs</code>. We can specify our own <code>crs</code> argument if we want to override the assumed projection. If we set the <code>crs</code> argument to a valid PROJ4 string, we can accoimplish this. Let’s project our <code>oz_states</code> onto a Mollewide graph.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> oz_states, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">fill =</span> NAME)) <span class="op">+</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="st">&quot;+proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;oz_states projected onto Mollewide ggplot&quot;</span>)</span></code></pre></div>
<p><img src="spatial_ggplot2_files/figure-html/unnamed-chunk-5-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>We did not overwrite the data to this new projection. We simply performed a transformation on the fly to fit the data to a new grid. Instead of a PROJ4 string, we could use an EPSG code with the <code>st_crs()</code> function. Let’s not project our data onto a grid with EPSG code 3112.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> oz_states, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">fill =</span> NAME)) <span class="op">+</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="kw">st_crs</span>(<span class="dv">3112</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;oz_states projected onto EPSG 3112&quot;</span>)</span></code></pre></div>
<p><img src="spatial_ggplot2_files/figure-html/unnamed-chunk-6-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p><code>st_crs()</code> is that simple, just plug in the code and the function will grab the PROJ4 string for you. <code>coord_sf</code> has other options that are useful too such as x and y limits. Let’s go back to our regular projection of this data and show the limits in action.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> oz_states, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">fill =</span> NAME), <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">140</span>, <span class="dv">150</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">44</span>, <span class="fl">-39.5</span>)) <span class="op">+</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="st">  </span><span class="kw">geom_sf_label</span>( <span class="dt">data =</span> oz_states, <span class="kw">aes</span>(<span class="dt">label =</span> NAME))</span></code></pre></div>
<p><img src="spatial_ggplot2_files/figure-html/unnamed-chunk-7-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>We also added <code>geom_sf_label</code> which adds a label to an <code>sf</code> geometry. In this case, we added the Tasmania name tag to the geometry.</p>
</div>
<div id="sea-surface-temperature-ggplot" class="section level2">
<h2><span class="header-section-number">1.2</span> Sea Surface Temperature ggplot</h2>
<p>When it comes to spatial data, the <code>raster</code> package is our go-to library. After the data is translated to a dataframe and ready to plot, we’ll need the help of a package called <code>mapproj</code> which makes sense of some external maps that <code>ggplot2</code> uses.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="kw">library</span>(mapproj)</span></code></pre></div>
<pre><code>## Loading required package: maps</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">library</span>(maptools) <span class="co"># also loads sp package</span></span></code></pre></div>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## Checking rgeos availability: FALSE
##      Note: when rgeos is not available, polygon geometry     computations in maptools depend on gpclib,
##      which has a restricted licence. It is disabled by default;
##      to enable gpclib, type gpclibPermit()</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">library</span>(raster)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="kw">library</span>(rasterVis)</span></code></pre></div>
<pre><code>## Loading required package: lattice</code></pre>
<pre><code>## Loading required package: latticeExtra</code></pre>
<pre><code>## 
## Attaching package: &#39;latticeExtra&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     layer</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">library</span>(RColorBrewer)</span>
<span id="cb20-2"><a href="#cb20-2"></a>sstRast &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;/Users/james/Documents/Github/geog473-673/datasets/GOES_R_ROLLING_1DAY_20190814.nc&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required namespace: ncdf4</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># crop the raster so this runs faster</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>sstRast &lt;-<span class="st"> </span><span class="kw">crop</span>(sstRast, <span class="kw">extent</span>(<span class="op">-</span><span class="dv">100</span>,<span class="op">-</span><span class="dv">80</span>,<span class="dv">16</span>,<span class="dv">30</span>))</span>
<span id="cb22-3"><a href="#cb22-3"></a>sstRast</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 774, 1111, 859914  (nrow, ncol, ncell)
## resolution : 0.018, 0.0181  (x, y)
## extent     : -99.99915, -80.00115, 15.99378, 30.00318  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : Sea.Surface.Temperature 
## values     : 25.86023, 34.9397  (min, max)
## time       : 2019-08-14 16:30:43</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># convert to dataframe and </span></span>
<span id="cb24-2"><a href="#cb24-2"></a>df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(sstRast, <span class="dt">xy =</span> <span class="ot">TRUE</span>)</span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="kw">head</span>(df)</span></code></pre></div>
<pre><code>##           x        y Sea.Surface.Temperature
## 1 -99.99015 29.99413                     NaN
## 2 -99.97215 29.99413                     NaN
## 3 -99.95415 29.99413                     NaN
## 4 -99.93615 29.99413                     NaN
## 5 -99.91815 29.99413                     NaN
## 6 -99.90015 29.99413                     NaN</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># plot the raster</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">data =</span> df , <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">fill =</span> Sea.Surface.Temperature)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="st">  </span><span class="kw">coord_sf</span>()</span></code></pre></div>
<p><img src="spatial_ggplot2_files/figure-html/unnamed-chunk-8-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>In this case, <code>df</code> is just a data frame - not an <code>sf</code> data frame. We need to use <code>geom_raster</code> in this case to plot a regular data frame as a raster. As for the projeciton, <code>ggplot</code> automatically guessed lat/long which in this case is correct. A better practice is to use the <code>crs</code> from the <code>sstRast</code> which contains all of the projection information.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># print the crs of the sstRast</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="kw">crs</span>(sstRast)</span></code></pre></div>
<pre><code>## CRS arguments: +proj=longlat +datum=WGS84 +no_defs</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># plug in crs into the `coord_sf` function</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">data =</span> df , <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">fill =</span> Sea.Surface.Temperature)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs=</span><span class="kw">crs</span>(sstRast))</span></code></pre></div>
<p><img src="spatial_ggplot2_files/figure-html/unnamed-chunk-9-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The georeferenced data is properly placed. Let’s now turn our attention to the coloring of the data. We can use the <code>RColorBrewer</code> package to create our own color palettes. Also, becuase we’re in lat/long projection, we’re going to use <code>coord_quickmap</code> instead of <code>coord_sf</code>. This function approximates geolocated lines for faster plotting. This can be used in lat/long projected data close to the equator.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># now let&#39;s use a better colorscheme</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>jet.colors &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&quot;#00007F&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;#007FFF&quot;</span>, <span class="st">&quot;cyan&quot;</span>, <span class="st">&quot;#7FFF7F&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;#FF7F00&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;#7F0000&quot;</span>))</span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">data =</span> df , <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">fill =</span> Sea.Surface.Temperature)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="st">  </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colors =</span> <span class="kw">jet.colors</span>(<span class="dv">7</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">28</span>, <span class="dv">33</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb30-6"><a href="#cb30-6"></a><span class="st">  </span><span class="kw">coord_quickmap</span>()</span></code></pre></div>
<p><img src="spatial_ggplot2_files/figure-html/unnamed-chunk-10-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># now let&#39;s add borders using the borders function</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">data =</span> df , <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">fill =</span> Sea.Surface.Temperature)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="st">  </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colors =</span> <span class="kw">jet.colors</span>(<span class="dv">7</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">28</span>, <span class="dv">33</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="st">  </span><span class="kw">borders</span>(<span class="dt">fill=</span><span class="st">&quot;white&quot;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>,<span class="op">-</span><span class="dv">80</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">16</span>,<span class="dv">30</span>),<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="st">  </span><span class="kw">coord_quickmap</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>,<span class="op">-</span><span class="dv">80</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">16</span>,<span class="dv">30</span>))</span></code></pre></div>
<p><img src="spatial_ggplot2_files/figure-html/unnamed-chunk-10-2.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Let’s get rid of the expanded area beyond the raster domain using the <code>expand=FALSE</code> argument in <code>coord_quickmap()</code></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">data =</span> df , <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">fill =</span> Sea.Surface.Temperature)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="st">  </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colors =</span> <span class="kw">jet.colors</span>(<span class="dv">7</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">28</span>, <span class="dv">33</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="st">  </span><span class="kw">borders</span>(<span class="dt">fill=</span><span class="st">&quot;white&quot;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>,<span class="op">-</span><span class="dv">80</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">16</span>,<span class="dv">30</span>),<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="st">  </span><span class="kw">coord_quickmap</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>,<span class="op">-</span><span class="dv">80</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">16</span>,<span class="dv">30</span>),<span class="dt">expand =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="spatial_ggplot2_files/figure-html/unnamed-chunk-11-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="r-color-brewer-palettes" class="section level2">
<h2><span class="header-section-number">1.3</span> R Color Brewer Palettes</h2>
<p>There are a number of pre-made color palettes from <code>RColorBrewer</code>. Here is a list.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="kw">library</span>(RColorBrewer)</span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="kw">display.brewer.all</span>()</span></code></pre></div>
<p><img src="spatial_ggplot2_files/figure-html/unnamed-chunk-12-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Let’s plot using a Yellow-Orange-Red palette and a white NA value</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>cols &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&quot;YlOrRd&quot;</span>) <span class="co"># maximum number of colors in palette YlOrRd is 9</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>pal &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(cols)</span>
<span id="cb34-3"><a href="#cb34-3"></a></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">data =</span> df , <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">fill =</span> Sea.Surface.Temperature)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb34-6"><a href="#cb34-6"></a><span class="st">  </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colors =</span> <span class="kw">pal</span>(<span class="dv">20</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">35</span>),<span class="dt">na.value =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="st">  </span><span class="kw">borders</span>(<span class="dt">fill=</span><span class="st">&quot;white&quot;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>,<span class="op">-</span><span class="dv">80</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">16</span>,<span class="dv">30</span>),<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="st">  </span><span class="kw">coord_quickmap</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>,<span class="op">-</span><span class="dv">80</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">16</span>,<span class="dv">30</span>),<span class="dt">expand =</span> <span class="ot">FALSE</span>)    </span></code></pre></div>
<p><img src="spatial_ggplot2_files/figure-html/unnamed-chunk-13-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div id="multi-plot-ggplot" class="section level3">
<h3><span class="header-section-number">1.3.1</span> Multi Plot ggplot</h3>
<p>Multiple Plots in one window is possible with ggplot2 but is done with a different method. Remember how we explicitly named ggplot2 instances in the previous tutorial? We must do that again in order to achieve the results we want. Let’s split up the image above into West Gulf of Mexico and East Gulf of Mexico.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="kw">library</span>(grid)</span>
<span id="cb35-3"><a href="#cb35-3"></a><span class="kw">library</span>(gridExtra)</span>
<span id="cb35-4"><a href="#cb35-4"></a></span>
<span id="cb35-5"><a href="#cb35-5"></a>p1 =<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb35-6"><a href="#cb35-6"></a><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">data =</span> df , <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">fill =</span> Sea.Surface.Temperature), <span class="dt">show.legend=</span><span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb35-7"><a href="#cb35-7"></a><span class="st">  </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colors =</span> <span class="kw">pal</span>(<span class="dv">20</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">35</span>),<span class="dt">na.value =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb35-8"><a href="#cb35-8"></a><span class="st">  </span><span class="kw">borders</span>(<span class="dt">fill=</span><span class="st">&quot;white&quot;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>,<span class="op">-</span><span class="dv">90</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">16</span>,<span class="dv">30</span>),<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb35-9"><a href="#cb35-9"></a><span class="st">  </span><span class="kw">coord_quickmap</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>,<span class="op">-</span><span class="dv">90</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">16</span>,<span class="dv">30</span>),<span class="dt">expand =</span> <span class="ot">FALSE</span>)    </span>
<span id="cb35-10"><a href="#cb35-10"></a></span>
<span id="cb35-11"><a href="#cb35-11"></a>p2 =<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb35-12"><a href="#cb35-12"></a><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">data =</span> df , <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">fill =</span> Sea.Surface.Temperature), <span class="dt">show.legend=</span><span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb35-13"><a href="#cb35-13"></a><span class="st">  </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colors =</span> <span class="kw">pal</span>(<span class="dv">20</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">35</span>),<span class="dt">na.value =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb35-14"><a href="#cb35-14"></a><span class="st">  </span><span class="kw">borders</span>(<span class="dt">fill=</span><span class="st">&quot;white&quot;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">90</span>,<span class="op">-</span><span class="dv">80</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">16</span>,<span class="dv">30</span>),<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb35-15"><a href="#cb35-15"></a><span class="st">  </span><span class="kw">coord_quickmap</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">90</span>,<span class="op">-</span><span class="dv">80</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">16</span>,<span class="dv">30</span>),<span class="dt">expand =</span> <span class="ot">FALSE</span>)    </span>
<span id="cb35-16"><a href="#cb35-16"></a></span>
<span id="cb35-17"><a href="#cb35-17"></a><span class="co"># use the grid.arrange function from grid and gridExtra to plot our 2 ggplots in the same window</span></span>
<span id="cb35-18"><a href="#cb35-18"></a><span class="kw">grid.arrange</span>(p1,p2, <span class="dt">ncol=</span><span class="dv">2</span>, <span class="dt">nrow=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="spatial_ggplot2_files/figure-html/unnamed-chunk-14-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p><code>grid.arrange</code> takes ggplot objects and plots them onto a window with specified rows and columns. Here we wanted these two separate plots side by side.</p>
<p>#Assignment:</p>
<ol style="list-style-type: decimal">
<li><p>Download <code>treecov.nc</code> from the datasets folder</p></li>
<li><p>For South America and Africa, plot the tree cover variable using <code>ggplot2</code>. Use a green color theme from <code>RColorBrewer</code>. Add borders.</p></li>
<li><p>Place each <code>ggplot</code> next to each other in one plot window using <code>grid.arrange</code>.</p></li>
<li><p>Submit resulting image to UD Canvas.</p></li>
</ol>
<p>Your final product should look something like…</p>
<p><img src="spatial_ggplot2_files/figure-html/unnamed-chunk-15-1.png" width="1344" /></p>
</div>
</div>
<div id="extra-credit---2-points" class="section level2">
<h2><span class="header-section-number">1.4</span> Extra Credit - 2 Points</h2>
<p>Using the data above, approximate the average tree cover for South America and Africa (extents don’t have to be exact, just generally)</p>
<ol style="list-style-type: decimal">
<li><p>Plot the same domains above but this time color each continent (yes, the whole thing) based on the average tree cover. For example, if one of the continent has an average tree cover of 30%, the entire continent would be red based on the colorscale you choose where 30% is red.</p></li>
<li><p>Submit plot and code to canvas</p></li>
</ol>
</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"search": false
});
});
</script>

</body>

</html>
